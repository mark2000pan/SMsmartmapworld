<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Moja GPS Mapa</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; }
        #map { height: 100vh; width: 100%; }

        /* Tla캜idlo pre moju polohu */
        .loc-btn {
            position: absolute;
            bottom: 25px;
            right: 25px;
            z-index: 1000;
            background: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .loc-btn:hover { background: #f4f4f4; }
    </style>
</head>
<body>

    <button class="loc-btn" onclick="najdiMa()" title="Moja poloha">游늸</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        // --- INICIALIZ츼CIA MAPY ---
        var map = L.map('map', {
            center: [48.66, 19.50],
            zoom: 7,
            minZoom: 3,
            maxBounds: [[-90, -180], [90, 180]],
            maxBoundsViscosity: 1.0
        });

        // --- MAPOV칗 PODKLAD (Bez opakovania sveta) ---
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            noWrap: true,
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // --- MOJE LOGO / FIRMA ---
        var logoMarker = L.marker([48.1485, 17.1077]).bindPopup("<b>Moje Logo</b><br>Bratislava");
        var vrstvaLogo = L.layerGroup([logoMarker]).addTo(map);

        // --- NAVIG츼CIA A VYH컇AD츼VANIE ---
        var routingControl = L.Routing.control({
            waypoints: [null, null], // Pr치zdne body pri 코tarte
            routeWhileDragging: true,
            language: 'sk',
            geocoder: L.Control.Geocoder.nominatim(), // Toto prid치 vyh쬬d치vanie do pol칤캜ok
            collapsible: true,
            placeholder: 'H쬬daj adresu...'
        }).addTo(map);

        // --- PREP칈NA캛 VRSTIEV (Ikonka vpravo hore) ---
        var baseMaps = { "Mapa": osm };
        var overlayMaps = { "Zobrazi콘 Logo": vrstvaLogo };
        L.control.layers(baseMaps, overlayMaps, { collapsed: false }).addTo(map);

        // --- FUNKCIA PRE GEOLOK츼CIU (Kde som?) ---
        function najdiMa() {
            map.locate({setView: true, maxZoom: 15});
        }

        // Ke캞 sa poloha n치jde
        map.on('locationfound', function(e) {
            // Nastav칤 tvoju polohu ako Bod A (코tart)
            routingControl.spliceWaypoints(0, 1, e.latlng);
            
            // Prid치 mal칳 kr칰쬺k na tvoju poz칤ciu
            L.circle(e.latlng, { radius: 10, color: 'blue' }).addTo(map);
        });

        // Ak sa polohu nepodar칤 zisti콘
        map.on('locationerror', function(e) {
            alert("Pr칤stup k polohe bol zamietnut칳 alebo zlyhal.");
        });

        // Spustenie lokaliz치cie ihne캞 po na캜칤tan칤
        window.onload = najdiMa;

    </script>
</body>
</html>
